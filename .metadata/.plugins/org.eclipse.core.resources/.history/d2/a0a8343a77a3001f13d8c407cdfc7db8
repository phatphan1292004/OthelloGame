package main;

import java.util.ArrayList;
import java.util.List;

public class Board {
    private int[][] boardState;
    private int currentPlayer;
    
    // Mảng các hướng di chuyển (cả thẳng và chéo)
    private int[][] offsets = {
        {0, 1}, {1, 0}, {0, -1}, {-1, 0}, // (dọc, ngang)
        {1, 1}, {1, -1}, {-1, -1}, {-1, 1} // (chéo)
    };

    public Board() {
        boardState = new int[8][8];

        // Thiết lập mặc định cho bàn cờ
        boardState[3][3] = -1; // Quân trắng
        boardState[3][4] = 1;  // Quân đen
        boardState[4][3] = 1;  // Quân đen
        boardState[4][4] = -1; // Quân trắng

        currentPlayer = 1; // Khởi tạo người chơi là đen (1)
    }

    // Cập nhật trạng thái của ô
    public void setState(int row, int col, int state) {
        if (boardState[row][col] == 0) {
            boardState[row][col] = state;
            flipPieces(row, col, state);
            switchPlayer(); 
        }
    }
    
    
    // Lật quân co    
    public void flipPieces(int row, int col, int player) {
        for (int[] offset : offsets) {
            int x = row + offset[0];
            int y = col + offset[1];
            List<int[]> toFlip = new ArrayList<>();

            // Tiến hành lặp qua các hướng để tìm quân đối phương và lật chúng
            while (x >= 0 && x < 8 && y >= 0 && y < 8 && boardState[x][y] == -player) {
                toFlip.add(new int[]{x, y});
                x += offset[0];
                y += offset[1];
            }

            // Nếu gặp phải quân của người chơi hiện tại và có quân đối phương bị kẹp
            if (x >= 0 && x < 8 && y >= 0 && y < 8 && boardState[x][y] == player) {
                for (int[] flip : toFlip) {
                    boardState[flip[0]][flip[1]] = player;  // Lật quân cờ đối phương
                }
            }
        }
    }

    // Lấy trạng thái của ô
    public int getState(int row, int col) {
        return boardState[row][col];
    }

    // Chuyển người chơi
    public void switchPlayer() {
        currentPlayer = (currentPlayer == 1) ? -1 : 1;
    }

    // Lấy ra người chơi gần nhất
    public int getCurrentPlayer() {
        return currentPlayer;
    }
    
    
    // Hàm đếm số lượng quân trắng, quân đen trên bàn cờ   
    public int countTileInBoard(int player) {
        int count = 0;

        for (int i = 0; i < boardState.length; i++) {
            for (int j = 0; j < boardState.length; j++) {
                if (boardState[i][j] == player) {
                    count++;  
                }
            }
        }
        
        return count;
    }
    
    public String checkWinner() {
    	int blackCount = countTileInBoard(1);
    	int whiteCount = countTileInBoard(-1);
    	
    	if (blackCount > whiteCount) {
            return "Black wins!";
        } else if (whiteCount > blackCount) {
            return "White wins!";
        } else {
            return "It's a draw!";
        }
    }
    
    public boolean isGameOver() {
        for (int i = 0; i < 8; i++) {
            for (int j = 0; j < 8; j++) {
                if (boardState[i][j] == 0) {
                    return false;
                }
            }
        }
        return true; 
    }
    
    
    
    public boolean isMoveValid(int row, int col, int player) {
        // Nếu ô đó không trống, thì không hợp lệ
        if (boardState[row][col] != 0) {
            return false;
        }

        // Kiểm tra tất cả các hướng (ngang, dọc, chéo)
        for (int[] offset : offsets) {
            int dx = offset[0];  // Hướng theo hàng (row)
            int dy = offset[1];  // Hướng theo cột (col)

            int x = row + dx;
            int y = col + dy;

            boolean opponentFound = false;

            // Duyệt theo hướng, tìm quân đối phương
            while (isInBounds(x, y) && boardState[x][y] == -player) {
                opponentFound = true;
                x += dx;
                y += dy;
            }

            // Nếu tìm thấy quân đối phương, kiểm tra xem có gặp quân của chính người chơi không
            if (opponentFound && isInBounds(x, y) && boardState[x][y] == player) {
                return true;  // Nước đi hợp lệ
            }
        }

        return false;  // Không tìm thấy nước đi hợp lệ
    }

    // Hàm kiểm tra nếu một ô có nằm trong giới hạn bàn cờ không
    private boolean isInBounds(int x, int y) {
        return x >= 0 && x < 8 && y >= 0 && y < 8;
    }
    
    
    public void reset() {
		for (int i = 0; i < 8; i++) {
			for (int j = 0; j < 8; j++) {
				boardState[i][j] = 1;
			}
		}

		  boardState[3][3] = -1; 
	      boardState[3][4] = 1;  
	      boardState[4][3] = 1;  
	      boardState[4][4] = -1; 

	      currentPlayer = 1; 
	}
}
